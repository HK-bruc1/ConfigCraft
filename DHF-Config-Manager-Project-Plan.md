# DHF Configuration Manager 项目计划

## 项目概述

### 项目名称
DHF Configuration Manager - DHF耳机固件配置可视化管理工具

### 项目背景

#### 现状问题
DHF AC710N-V300P03 SDK中，每个客户产品都需要独立的配置文件（如`customer\GK158_Left\customer.conf`），这些配置文件：

1. **复杂度高**：400+行配置，包含按键映射、灯效设置、通话场景等多个模块
2. **语法复杂**：使用自定义的宏形式，如：
   ```conf
   # 通话中单击操作
   _ACTIVE_DEVICE_KEY_ACTION_CLICK=APP_MSG_NULL
   
   # TWS连接状态下右耳单击
   _TWS_STA_PHONE_CONNECTED_SIBLING_CONNECTED_KEY_ACTION_CLICK_R=APP_MSG_VOL_UP
   
   # 蓝牙连接后灯效配置
   _LED_BT_STATUS_CONNECTED_NAME=LED_STA_ALL_OFF
   _LED_BT_STATUS_CONNECTED_DISP_MODE=DISP_CLEAR_OTHERS | DISP_TWS_SYNC
   ```
3. **维护困难**：配置项命名冗长，缺乏层次结构，容易出错
4. **扩展性差**：新增配置项需要深度了解现有命名规范和依赖关系
5. **团队协作问题**：非技术人员无法直接修改配置

#### 典型配置结构分析
以`customer\GK158_Left\customer.conf`为例，配置文件包含以下主要模块：

- **基础配置**：IC型号选择、VM区域管理、功放控制等
- **按键功能配置**：
  - 通话场景（来电、拨号、通话中、三方通话）
  - 音乐场景（TWS连接/断开状态下的左右耳按键映射）
  - 特殊组合键（工厂重置、DUT模式等）
- **灯效配置**：
  - TWS对耳连接状态灯效
  - 蓝牙连接状态灯效  
  - 应用事件灯效（开关机、超距断开）
  - 电池充电状态灯效
- **电源管理**：低电提醒、充电控制等

### 项目目标
为DHF AC710N-V300P03 SDK提供一个轻量级、高效的可视化配置管理工具，将复杂的conf配置文件通过YAML中间层实现可视化编辑，提升开发效率。

### 核心价值
- **零学习成本**：图形化界面，无需了解conf文件语法
- **弹性扩展**：基于YAML schema动态生成UI，易于添加新配置项
- **高效输出**：直接生成标准conf格式，无缝集成现有构建流程
- **轻量快速**：Go + Fyne打包后单exe文件，启动速度快

### 预期使用效果

#### 使用流程
1. **启动工具**：双击`dhf-config-manager.exe`，2秒内启动完成
2. **创建配置**：
   - 选择产品类型（如GK158_Left）
   - 系统自动加载对应的YAML配置模板
3. **可视化编辑**：
   ```
   左侧导航树               右侧编辑面板
   ├─ 📱 基础配置            ┌─────────────────────┐
   ├─ ⌨️  按键配置           │ IC型号: [AC7106A8 ▼]  │
   │  ├─ 通话场景           │ VM操作: [擦除 ▼]      │
   │  ├─ 音乐场景           │ 功放控制: ☑ 手动开启   │
   │  └─ 组合键             └─────────────────────┘
   ├─ 💡 灯效配置
   │  ├─ TWS连接
   │  ├─ 蓝牙状态  
   │  └─ 系统事件
   └─ 🔋 电源管理
   ```
4. **实时验证**：配置项互相依赖关系自动检查，错误项高亮提示
5. **导出配置**：一键生成标准的`customer.conf`文件，保持原有格式和注释

#### 界面特性
- **直观的分组导航**：按功能模块组织，便于快速定位
- **智能表单控件**：
  - 枚举值显示为下拉选择框
  - 数值配置提供数字输入框和滑块
  - 布尔配置使用复选框
  - 复杂配置提供专用编辑器
- **配置预览**：实时显示生成的conf文件内容
- **模板管理**：支持保存和加载配置模板

#### 效率提升
- **配置时间**：从30分钟缩短到5分钟
- **出错率**：减少90%的配置错误
- **学习成本**：新手无需培训即可使用
- **维护效率**：配置项增加时，只需更新YAML schema，界面自动适配

## 技术架构

### 技术栈选择
- **语言**: Go 1.21+
- **GUI框架**: Fyne v2.4+ 
- **YAML解析**: gopkg.in/yaml.v3
- **打包方式**: 单exe可执行文件
- **目标平台**: Windows 10/11

### 架构设计
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   YAML Schema   │───▶│  UI Generator   │───▶│   Fyne GUI      │
│   (配置模板)     │    │   (界面生成)     │    │   (用户界面)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
          │                                              │
          │                                              ▼
          │              ┌─────────────────┐    ┌─────────────────┐
          └─────────────▶│ Config Parser   │◀───│  User Config    │
                         │  (配置解析器)    │    │  (用户配置)      │
                         └─────────────────┘    └─────────────────┘
                                  │
                                  ▼
                         ┌─────────────────┐
                         │ Conf Generator  │
                         │  (conf输出)     │
                         └─────────────────┘
```

## 开发环境配置

### 必需软件
1. **Go语言环境**
   - 版本：Go 1.21 或更高版本
   - 下载地址：https://golang.org/dl/
   - 安装大小：约150MB

2. **开发工具**（可选）
   - VS Code + Go扩展
   - 或任意文本编辑器

### 环境验证
```bash
go version  # 验证Go安装
go env GOOS GOARCH  # 确认目标平台
```

### 项目依赖
```go
// go.mod
module dhf-config-manager

go 1.21

require (
    fyne.io/fyne/v2 v2.4.3
    gopkg.in/yaml.v3 v3.0.1
)
```

## 项目结构设计

```
dhf-config-manager/
├── main.go                 # 应用程序入口
├── go.mod                  # Go模块定义
├── go.sum                  # 依赖校验文件
├── README.md               # 项目说明文档
├── build/                  # 构建脚本和输出
│   ├── build.bat          # Windows构建脚本
│   └── dhf-config-manager.exe  # 输出的可执行文件
├── internal/               # 核心业务逻辑
│   ├── config/            # 配置相关
│   │   ├── parser.go      # YAML配置解析器
│   │   ├── generator.go   # conf文件生成器
│   │   └── validator.go   # 配置验证器
│   ├── ui/                # UI相关
│   │   ├── app.go         # 应用程序主界面
│   │   ├── components/    # UI组件
│   │   │   ├── tree.go    # 配置树组件
│   │   │   ├── editor.go  # 配置编辑器组件
│   │   │   └── toolbar.go # 工具栏组件
│   │   └── theme.go       # 界面主题
│   └── models/            # 数据模型
│       ├── schema.go      # YAML schema结构
│       ├── config.go      # 配置数据结构
│       └── types.go       # 通用类型定义
├── assets/                # 静态资源
│   ├── icons/             # 图标文件
│   └── schemas/           # YAML配置模板
│       └── dhf-schema.yaml # DHF配置schema
└── examples/              # 示例配置
    ├── gk158-left.yaml    # GK158左耳配置示例
    └── gk158-right.yaml   # GK158右耳配置示例
```

## 核心功能模块

### 1. 配置Schema设计
定义YAML配置文件的结构和UI生成规则：

```yaml
# assets/schemas/dhf-schema.yaml
schema_version: "1.0"
display_name: "DHF耳机配置"

sections:
  basic:
    name: "基础配置"
    icon: "settings"
    fields:
      ic_model:
        type: "select"
        label: "IC型号"
        options:
          - {value: 0, label: "AC7106A8"}
          - {value: 1, label: "AC7103D4"}
        default: 0
      
  key_actions:
    name: "按键配置"
    icon: "keyboard"
    groups:
      call_scenario:
        name: "通话场景"
        fields:
          active_click:
            type: "select"
            label: "通话中单击"
            options:
              - {value: "APP_MSG_NULL", label: "无操作"}
              - {value: "APP_MSG_CALL_ANSWER", label: "接听"}
              - {value: "APP_MSG_CALL_HANGUP", label: "挂断"}
      
  led_config:
    name: "灯效配置" 
    icon: "lightbulb"
    # ...更多配置项
```

### 2. UI动态生成器
根据schema自动生成对应的UI控件：

- **树形导航**：左侧显示配置分组
- **表单编辑**：右侧显示当前分组的配置项
- **类型适配**：
  - `select` → 下拉选择框
  - `text` → 文本输入框
  - `number` → 数字输入框
  - `boolean` → 复选框

### 3. 配置管理核心
- **加载配置**：读取YAML配置文件和用户配置
- **实时验证**：配置项输入验证和依赖检查
- **配置保存**：将用户配置保存为YAML格式
- **conf导出**：将配置转换为标准conf格式

### 4. 用户界面设计
- **菜单栏**：文件操作（新建、打开、保存、导出）
- **工具栏**：快捷操作按钮
- **主界面**：左右分栏布局
  - 左侧：配置树形导航
  - 右侧：配置项编辑面板
- **状态栏**：显示当前状态和提示信息

## 开发计划

### 第一阶段：基础框架搭建（1-2天）
- [x] 项目初始化和环境配置
- [ ] 基础UI框架搭建
- [ ] YAML解析模块实现
- [ ] 简单的配置加载和显示

### 第二阶段：核心功能实现（2-3天）
- [ ] Schema解析和UI动态生成
- [ ] 配置项编辑功能
- [ ] 配置验证和错误提示
- [ ] 基础的文件操作功能

### 第三阶段：配置转换功能（1-2天）
- [ ] YAML到conf的转换逻辑
- [ ] conf格式化和注释处理
- [ ] 导出功能实现

### 第四阶段：界面优化和测试（1-2天）
- [ ] UI美化和用户体验优化
- [ ] 功能测试和bug修复
- [ ] 打包和部署测试

### 第五阶段：文档和交付（1天）
- [ ] 用户使用文档
- [ ] 安装部署说明
- [ ] 项目交付

## 质量保证

### 代码规范
- 遵循Go语言标准编码规范
- 使用gofmt进行代码格式化
- 添加必要的注释和文档

### 测试策略
- 单元测试：核心业务逻辑
- 集成测试：YAML解析和conf生成
- 用户测试：界面操作和用户体验

### 性能要求
- 启动时间：< 2秒
- 内存占用：< 50MB
- 响应时间：配置项切换 < 200ms

## 部署方案

### 构建流程
```bash
# 构建Windows可执行文件
go build -ldflags "-w -s" -o dhf-config-manager.exe

# 或使用构建脚本
./build/build.bat
```

### 分发方式
- 单exe文件分发，无需安装
- 配置schema文件内嵌到exe中
- 用户配置文件保存到用户目录

### 版本管理
- 语义化版本号（如v1.0.0）
- 配置schema版本兼容性检查
- 自动备份用户配置

## 风险评估

### 技术风险
- **Fyne框架稳定性**：中等风险，有备选方案
- **YAML复杂性**：低风险，结构相对简单
- **Windows兼容性**：低风险，Go跨平台支持好

### 项目风险
- **需求变更**：中等风险，通过弹性schema设计降低
- **用户接受度**：低风险，界面直观易用
- **维护成本**：低风险，代码结构清晰

## 成功标准

### 功能标准
- [x] 成功解析现有conf文件结构
- [ ] 完整支持所有配置项的可视化编辑
- [ ] 生成的conf文件与原格式100%兼容
- [ ] 支持配置项的增加和删除

### 性能标准
- 单exe文件大小 < 15MB
- 启动时间 < 2秒
- 界面响应流畅，无明显卡顿

### 用户体验标准
- 界面直观，无需培训即可使用
- 配置项分组清晰，便于查找
- 支持配置导入/导出，便于备份

## 后续扩展计划

### 功能扩展
- 支持多配置文件对比
- 配置模板功能
- 批量配置生成
- 配置项搜索功能

### 平台扩展
- macOS版本支持
- Linux版本支持
- Web版本（可选）

---

## 项目启动检查清单

- [ ] Go开发环境已安装并验证
- [ ] 项目目录结构已创建
- [ ] 依赖包已配置（go.mod）
- [ ] 第一阶段开发任务已明确
- [ ] 开发时间计划已确定

**预计总开发时间：7-10天**
**项目优先级：高**
**技术难度：中等**

---

*本项目计划书最后更新时间：2025-01-19*