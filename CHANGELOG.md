# 更新日志

本文档记录了DHF Configuration Manager项目的所有重要变更。

## [v0.3.2] - 2025-08-21

### 🔧 配置分组顺序一致性修复
- **解决核心问题**: 修复配置分组位置随机变化的问题
- **根本原因**: Go map遍历的随机性导致界面每次加载顺序不一致
- **技术方案**: 在三个关键位置实施固定排序逻辑

### 🎯 修复范围
- **parser.go**: 移除conf文件生成时的字母排序，保持YAML原始顺序
- **app.go**: 修复动态schema生成时的map随机遍历问题
- **tree.go**: **关键修复** - ConfigTree渲染时的section随机遍历

### ✨ 排序优先级
```
固定显示顺序：
1. basic (基础配置)
2. key_actions (按键配置) 
3. led_config (LED配置)
4. factory (工厂设置)
5. advanced (高级设置)
其他分组按字典序排列
```

### 🔍 技术细节
- **一致性保证**: 三个组件使用相同的排序逻辑
- **性能优化**: 排序操作仅在界面构建时执行一次
- **向后兼容**: 不影响现有配置文件的功能

### 🚀 用户体验提升
- **稳定界面**: 每次加载相同YAML文件，分组位置完全一致
- **逻辑顺序**: 按配置重要性优先级排列，符合使用习惯
- **减少困惑**: 消除界面"跳跃"，提供稳定的操作体验

### 📊 问题解决记录
```
❌ 问题现象:
- 相同YAML文件每次加载分组位置不同
- 界面显示随机性影响用户操作
- 配置项位置不可预测

✅ 解决方案:
- 统一排序逻辑，确保三处遍历一致性
- 优先级排序 + 字典序后备机制
- 彻底消除Go map随机遍历的影响
```

这是一个重要的稳定性修复，解决了影响日常使用的关键体验问题！

---

## [v0.3.1] - 2025-08-21

### 🎨 树形控件体验重大改进
- **彻底解决闪烁问题**: 完全重写树形控件，替换有问题的Fyne Tree组件
- **消除位置漂移**: 使用自定义VBox容器和动态渲染，避免Tree控件内在刷新机制缺陷
- **流畅展开动画**: 展开/收缩操作完全无闪烁，交互响应更加稳定

### ✨ 简约优雅的界面设计
- **简约箭头图标**: 使用 `▶` (收缩) 和 `▼` (展开) 经典箭头设计
- **紧凑布局优化**: 缩进调整为2个空格，按钮尺寸优化至20x20像素
- **清晰层级关系**: 移除冗余装饰，保持简洁专业的视觉风格

### 🔧 技术架构升级
- **自定义树控件**: 基于TreeNode结构的完全自主实现
- **智能渲染机制**: 动态节点管理，避免不必要的重绘操作
- **性能优化**: 减少UI刷新频率，提升大型配置文件的响应速度

### 🚀 用户体验提升
- **即时响应**: 点击展开/收缩立即生效，无延迟和视觉跳跃
- **视觉一致性**: 所有节点对齐完美，界面更加整洁专业
- **操作直观**: 简化的图标语言，降低认知负担

### 📊 问题解决记录
```
❌ 原Fyne Tree问题:
- 展开时节点闪烁和位置漂移
- 刷新机制导致的视觉跳跃
- 复杂层级结构下的性能问题

✅ 自定义Tree解决方案:
- 基于VBox的稳定容器架构
- 节点状态完全自主控制
- 简约美观的UI设计
```

这是界面体验的重大突破，彻底解决了困扰用户的树形控件问题！

---

## [v0.3.0] - 2025-08-21

### 🎯 通用YAML配置工具重大升级
- **通用YAML支持**: 移除对固定schema的依赖，支持任意YAML结构
- **智能界面生成**: 根据YAML内容动态生成配置界面
- **智能保存逻辑**: 自动覆盖原文件 + 生成DHF conf文件
- **优化文件选择**: 改进文件对话框起始路径设置

---

## [v0.2.1] - 2025-08-20

### 🌍 中文支持重大突破
- **完全解决中文字体显示问题**: 通过FYNE_FONT环境变量强制使用系统中文字体
- **技术方案**: 使用`FYNE_FONT=C:\Windows\Fonts\simhei.ttf`设置黑体字体
- **关键发现**: Fyne框架不支持TTC字体集合文件，需使用单个TTF字体文件
- **用户体验**: 中文用户现在可以使用母语进行所有配置操作

### 🔧 技术实现细节
- **字体兼容性问题解决**: 从微软雅黑TTC切换到黑体TTF格式
- **环境变量集成**: 在main.go中自动设置FYNE_FONT环境变量
- **主题系统**: 配合SimpleChineseTheme实现完整中文支持
- **错误处理**: 添加字体加载状态监控和错误报告

### 📋 项目结构优化
- **单一语言版本**: 移除英文schema文件，专注中文用户体验
- **配置文件**: 基于真实customer.conf创建准确的中文配置项
- **文档更新**: CLAUDE.md记录完整的中文字体解决方案

### 🎯 用户价值
- **真正的本地化**: 界面完全中文化，符合中国用户习惯
- **配置直观**: 基于实际DHF配置项的中文标签和说明
- **技术突破**: 解决了Fyne框架中文显示的核心技术难题

### 🛠 解决方案记录
```bash
# 中文字体显示解决方案
FYNE_FONT=C:\Windows\Fonts\simhei.ttf

# 字体文件要求
- 使用TTF单个字体文件，不支持TTC字体集合
- 推荐使用系统预装的simhei.ttf（黑体）
- 确保字体文件路径正确且可访问
```

这是DHF Configuration Manager发展史上的重要里程碑，真正实现了对中文用户的完整支持！

---

## [v0.2.0] - 2025-08-20

### 🎨 UI/UX 重大改进
- **现代化布局**: 完全重新设计GUI界面布局
- **工具栏优化**: 移至顶部左上角，单行排列，添加分界线
- **双面板设计**: 左侧配置分组导航(30%)，右侧详细配置选项(70%)
- **清晰分区**: "Configuration Groups" 和 "Configuration Options" 标签明确功能分区

### ✨ 新增功能
- **关于对话框**: 现代化About按钮，显示版本信息和作者信息
- **响应式设计**: 保持900x650窗口尺寸约束下的最佳布局
- **卡片式布局**: 配置选项采用分组卡片设计，提升可读性

### 🔧 技术优化
- **组件架构**: 重构UI组件，支持更灵活的布局管理
- **界面简化**: 移除冗余版本信息显示，集中到About对话框
- **代码组织**: 优化组件间的类型定义和接口设计

### 🛠 开发约束
- **GUI尺寸**: 明确写入CLAUDE.md，窗口大小固定为900x650像素
- **布局原则**: 确立现代化、简洁、功能明确的设计方向

### 📋 界面元素更新
- **工具栏按钮**: New, Open, Save, Export to DHF, About
- **分界线**: 工具栏与主要区域的清晰分隔
- **状态栏**: 简化状态信息显示
- **树形导航**: 优化分支和叶子节点的视觉区分

### 🎯 用户体验提升
- **直观导航**: 左右分区让功能划分更加清晰
- **信息层次**: 通过视觉分组提升配置项的可发现性
- **操作流程**: 简化从选择分组到编辑配置的用户路径

---

## [v0.1.0] - 2025-01-19

### 🎉 首次发布
- 项目初始化，建立基础架构
- 实现核心功能和GUI界面

### ✨ 新增功能
- **GUI界面**: 基于Fyne的现代化图形界面
- **配置管理**: 完整的DHF耳机配置支持
- **动态UI**: 基于YAML schema的UI自动生成
- **文件操作**: 支持conf文件导出和YAML配置保存
- **命令行版本**: 提供CLI版本用于快速配置
- **响应式布局**: 支持窗口大小调整和分栏拖拽

### 🔧 技术实现
- **架构**: 采用MVC模式，模块化设计
- **配置引擎**: YAML解析器和conf生成器
- **UI组件**: 树形导航、配置编辑器、工具栏
- **构建系统**: TDM-GCC编译，单exe输出

### 📋 支持的配置项
- **基础配置**: IC型号选择、VM操作、功放控制
- **按键配置**: 
  - 通话场景 (来电、通话中、拨号等)
  - 音乐场景 (TWS连接状态下的左右耳配置)
  - 特殊按键 (工厂重置、DUT模式、电源控制)
- **LED配置**:
  - TWS连接状态灯效
  - 蓝牙连接状态灯效
  - 系统事件灯效 (开关机、低电量)
  - 充电状态灯效
- **高级配置**: 工厂重置参数、超时设置

### 🛠 开发工具
- **构建脚本**: `build-tdm.bat` 一键编译
- **测试工具**: 简化版本用于功能验证
- **文档**: 完整的README和项目计划

### 🐛 已知问题
- GUI界面中文字符显示乱码
- 配置文件导入功能尚未实现
- 缺少配置验证和错误提示

### 📊 项目统计
- **代码行数**: ~1000行Go代码
- **文件大小**: 约18MB (编译后)
- **启动速度**: < 2秒
- **支持配置项**: 50+ 个真实配置参数

### 🔄 下个版本计划
- 修复中文显示问题
- 实现配置文件导入功能
- 添加配置验证机制
- 优化用户体验和界面设计

---

## 版本说明

版本号格式: `主版本号.次版本号.修订号`

- **主版本号**: 重大架构变更或不向后兼容的更新
- **次版本号**: 新增功能，向后兼容
- **修订号**: 问题修复和小改进

## 标签说明

- 🎉 首次发布
- ✨ 新增功能  
- 🔧 技术改进
- 🐛 问题修复
- 📋 配置支持
- 🛠 开发工具
- 📊 统计信息
- 🔄 计划内容